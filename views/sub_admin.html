<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../css/sup_admin.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      body {
        font-family: Arial;
        background-color: #f9f9f9;
        margin: 0;
        padding: 0;
      }

      /* New Sidebar Styles */
      .profile-sidebar {
        width: 250px;
        background: #90ba9ec0;
        color: white;
        height: 100vh;
        position: fixed;
        top: 0;
        left: 0;
        padding: 20px 0;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      }

      .profile-nav-header {
        text-align: center;
        padding: 20px;
      }

      .profile-nav-header .image img {
        width: 150px;
        height: auto;
      }

      .profile-nav-list {
        margin-top: 30px;
      }

      .profile-nav-list .list-group-item {
        display: block;
        padding: 0;
        margin-bottom: 5px;
      }

      .profile-nav-list .btn {
        width: 100%;
        padding: 12px 20px;
        text-align: left;
        color: white;
        background: transparent;
        border: none;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .profile-nav-list .btn:hover,
      .profile-nav-list .btn.active {
        background: #439e69;
      }

      .profile-nav-list .btn i {
        margin-right: 10px;
      }

      .logout-btn {
        color: #ff6b6b !important;
      }

      .header {
        margin-left: 270px;
        background: #27ae60;
        color: white;
        padding: 20px;
        font-size: 24px;
      }

      .container {
        margin-left: 270px;
        padding: 20px;
      }

      form {
        background: white;
        padding: 20px;
        border-radius: 8px;
        width: 80%;
        margin: auto;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      form input,
      form select,
      form textarea {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }

      form label {
        font-weight: bold;
        display: block;
        margin-bottom: 5px;
      }

      .btn-primary {
        background: #27ae60;
        color: white;
        padding: 10px 20px;
        border: none;
        cursor: pointer;
        font-size: 16px;
        border-radius: 5px;
      }

      .equipment-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 40px;
      }

      .equipment-table th,
      .equipment-table td {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: center;
      }

      .equipment-table th {
        background: #27ae60;
        color: white;
      }

      .equipment-table tr:nth-child(even) {
        background: #f2f2f2;
      }

      .equipment-table img {
        width: 60px;
        height: 60px;
        object-fit: cover;
      }
    </style>
  </head>
  <body>
    <div class="sup-admin">
      <div class="side-bar">
        <div class="profile-sidebar" id="sidebar">
          <div class="profile-nav-header">
            <div class="image">
              <img
                src="../images/Logo-removebg-preview.png"
                alt="Logo"
                class="logo"
              />
            </div>
          </div>

          <div class="profile-nav-list">
            <a href="sub_admin.html" class="list-group-item">
              <button class="btn active">
                <i class="fas fa-plus-circle"></i> Home Page
              </button>
            </a>
            <a href="product-review.html" class="list-group-item">
              <button class="btn">
                <i class="fas fa-star"></i> Product Reviews
              </button>
            </a>
            <a href="#" class="list-group-item" onclick="logout()">
              <button class="btn logout-btn">
                <i class="fas fa-sign-out-alt"></i> Logout
              </button>
            </a>
          </div>
        </div>
      </div>
      <div class="form-sup-admin">
        <!DOCTYPE html>
        <html lang="en" dir="ltr">
          <head>
            <meta charset="UTF-8" />
            <meta
              name="viewport"
              content="width=device-width, initial-scale=1.0"
            />
            <title>Medical Equipment Management</title>
            <link
              rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
            />
            <style>
              body {
                font-family: "Arial", sans-serif;
                background-color: #85aa911e;
                margin: 0;
                padding: 20px;
                direction: ltr;
              }
              .container {
                max-width: 1200px;
                margin: 20px auto;
                background-color: #ffffff;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
              }
              h2 {
                color: #333;
                text-align: center;
                margin-bottom: 30px;
                font-size: 2em;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
              }
              h2 .fas {
                color: #648d66;
              }
              .form-row {
                display: flex;
                gap: 20px;
                margin-bottom: 15px;
              }
              .form-group {
                flex: 1;
                margin-bottom: 15px;
              }
              .form-group label {
                display: block;
                margin-bottom: 8px;
                color: #555;
                font-weight: bold;
              }
              .form-group input[type="text"],
              .form-group input[type="number"],
              .form-group select,
              .form-group textarea {
                width: 100%;
                padding: 12px;
                border: 1px solid #ddd;
                border-radius: 8px;
                font-size: 1em;
                box-sizing: border-box;
                box-shadow: rgba(134, 187, 134, 0.6) 3px 3px 3px 3px;
                transition: border-color 0.3s;
              }
              .form-group input[type="text"]:focus,
              .form-group input[type="number"]:focus,
              .form-group select:focus,
              .form-group textarea:focus {
                border-color: #648d66;
                outline: none;
              }
              .form-group textarea {
                resize: vertical;
                min-height: 100px;
              }
              .upload-area {
                border: 2px dashed #648d66;
                border-radius: 8px;
                padding: 30px;
                text-align: center;
                cursor: pointer;
                color: #648d66a6;
                transition: background-color 0.3s, border-color 0.3s;
              }
              .upload-area:hover {
                background-color: #e9eefd;
                border-color: #648d66;
              }
              .image-preview {
                margin-top: 15px;
                text-align: center;
              }
              .image-preview img {
                max-width: 100%;
                height: auto;
                border-radius: 8px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
              }
              .btn-primary {
                background-color: #648d66;
                color: white;
                padding: 12px 25px;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-size: 1.1em;
                transition: background-color 0.3s, transform 0.2s;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                margin-top: 20px;
              }
              .btn-primary:hover {
                background-color: #648d66;
                transform: translateY(-2px);
              }
              .btn-primary .fas {
                margin-left: 8px;
              }
              .btn-secondary {
                background-color: #a0aec0;
                color: white;
                padding: 12px 25px;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-size: 1.1em;
                transition: background-color 0.3s, transform 0.2s;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                margin-top: 20px;
              }
              .btn-secondary:hover {
                background-color: #8f9bb3;
                transform: translateY(-2px);
              }

              /* Table Styles */
              .equipment-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 25px;
                background-color: #fff;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
              }
              .equipment-table thead th {
                background-color: #648d66;
                color: white;
                padding: 15px 10px;
                text-align: left;
                font-weight: bold;
                font-size: 1.05em;
              }
              .equipment-table tbody td {
                padding: 12px 10px;
                border-bottom: 1px solid #eee;
                color: #444;
                vertical-align: middle;
              }
              .equipment-table tbody tr:last-child td {
                border-bottom: none;
              }
              .equipment-table tbody tr:hover {
                background-color: #f9fbfd;
              }
              .equipment-image {
                width: 70px;
                height: 70px;
                object-fit: cover;
                border-radius: 6px;
                border: 1px solid #eee;
              }
              .no-data {
                text-align: center;
                padding: 40px;
                color: #888;
                font-size: 1.2em;
              }

              /* Badges */
              .field-badge,
              .status-badge,
              .action-badge {
                display: inline-block;
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 0.85em;
                font-weight: bold;
                color: white;
                text-align: center;
                white-space: nowrap;
              }
              .field-dental {
                background-color: #4caf50;
              }
              .field-veterinary {
                background-color: #ffc107;
                color: #333;
              }
              .field-gynecology {
                background-color: #e91e63;
              }

              .status-excellent {
                background-color: #28a745;
              }
              .status-very-good {
                background-color: #17a2b8;
              }
              .status-good {
                background-color: #ffc107;
                color: #333;
              }

              .action-rent {
                background-color: #6f42c1;
              }
              .action-sell {
                background-color: #dc3545;
              }
              .action-both {
                background-color: #007bff;
              }

              /* Action Buttons in Table */
              .equipment-table .delete-btn {
                background-color: #dc3545;
                color: white;
                border: none;
                padding: 8px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 12px;
                transition: background-color 0.3s;
                margin-bottom: 5px;
                width: 100%;
              }
              .equipment-table .delete-btn:hover {
                background-color: #c82333;
              }
              .equipment-table .edit-btn {
                background: rgb(233, 233, 83);
                color: white;
                border: none;
                padding: 8px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 12px;
                transition: background-color 0.3s;
                width: 100%;
              }
              .equipment-table .edit-btn:hover {
                background-color: rgb(233, 233, 87);
              }
            </style>
          </head>
          <body>
            <div class="container">
              <div class="content">
                <h2>
                  <i class="fas fa-plus-circle"></i> Add New Medical Equipment
                </h2>
                <form id="equipmentForm">
                  <div class="form-row">
                    <div class="form-group">
                      <label for="brandName">Brand Name</label>
                      <input
                        type="text"
                        id="brandName"
                        name="brandName"
                        required
                        placeholder="e.g., Philips, Siemens, etc."
                      />
                    </div>
                    <div class="form-group">
                      <label for="equipmentName">Equipment Name</label>
                      <input
                        type="text"
                        id="equipmentName"
                        name="equipmentName"
                        required
                        placeholder="e.g., X-ray machine, Monitor, etc."
                      />
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="field">Field</label>
                      <select id="field" name="field" required>
                        <option value="">Select Field</option>
                        <option value="dental">Dentistry</option>
                        <option value="veterinary">Veterinary</option>
                        <option value="gynecology">Gynecology</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="condition">Condition</label>
                      <select id="condition" name="condition" required>
                        <option value="">Select Condition</option>
                        <option value="excellent">Excellent</option>
                        <option value="very-good">Very Good</option>
                        <option value="good">Good</option>
                      </select>
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="action">Action</label>
                      <select
                        id="action"
                        name="action"
                        required
                        onchange="togglePriceFields()"
                      >
                        <option value="">Select Action</option>
                        <option value="rent">Rent</option>
                        <option value="sell">Sell</option>
                        <option value="both">Both (Rent & Sell)</option>
                      </select>
                    </div>
                    <div
                      class="form-group"
                      id="rentDurationGroup"
                      style="display: none"
                    >
                      <label for="rentDuration">Rental Duration (Months)</label>
                      <select id="rentDuration" name="rentDuration">
                        <option value="">Select Duration</option>
                        <option value="3">3 Months</option>
                        <option value="6">6 Months</option>
                        <option value="12">12 Months</option>
                        <option value="more">More than 12 Months</option>
                      </select>
                    </div>
                  </div>

                  <div class="form-row">
                    <div
                      class="form-group"
                      id="rentPriceGroup"
                      style="display: none"
                    >
                      <label for="rentPrice">Rental Price (EGP)</label>
                      <input
                        type="number"
                        id="rentPrice"
                        name="rentPrice"
                        step="0.01"
                        placeholder="0.00"
                      />
                    </div>
                    <div
                      class="form-group"
                      id="sellPriceGroup"
                      style="display: none"
                    >
                      <label for="sellPrice">Selling Price (EGP)</label>
                      <input
                        type="number"
                        id="sellPrice"
                        name="sellPrice"
                        step="0.01"
                        placeholder="0.00"
                      />
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="description">Description</label>
                    <textarea
                      id="description"
                      name="description"
                      required
                      placeholder="Enter detailed description about the equipment and its features..."
                    ></textarea>
                  </div>

                  <div class="form-group">
                    <label for="equipmentImage">Equipment Image</label>
                    <div
                      class="upload-area"
                      onclick="document.getElementById('equipmentImage').click()"
                    >
                      <i
                        class="fas fa-cloud-upload-alt"
                        style="
                          font-size: 48px;
                          color: #648d66;
                          margin-bottom: 10px;
                        "
                      ></i>
                      <p>Click to select image or drag image here</p>
                      <input
                        type="file"
                        id="equipmentImage"
                        name="equipmentImage"
                        accept="image/*"
                        style="display: none"
                        onchange="previewImage(this)"
                      />
                    </div>
                    <div id="imagePreview" class="image-preview"></div>
                  </div>

                  <button type="submit" class="btn-primary">
                    <i class="fas fa-plus"></i>
                    <span id="submitBtnText">Add Equipment</span>
                  </button>
                  <button
                    type="button"
                    id="cancelEdit"
                    class="btn-secondary"
                    style="display: none; margin-right: 10px"
                    onclick="cancelEdit()"
                  >
                    <i class="fas fa-times"></i> Cancel Edit
                  </button>
                </form>

                <div id="equipment-list" class="form-container">
                  <h2><i class="fas fa-list"></i> Available Equipment List</h2>
                  <div id="equipmentTableContainer">
                    <table class="equipment-table">
                      <thead>
                        <tr>
                          <th>Image</th>
                          <th>Brand Name</th>
                          <th>Equipment Name</th>
                          <th>Field</th>
                          <th>Condition</th>
                          <th>Action</th>
                          <th>Duration</th>
                          <th>Rental Price</th>
                          <th>Selling Price</th>
                          <th>Description</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="equipmentTableBody">
                        <tr>
                          <td colspan="11" class="no-data">
                            <i
                              class="fas fa-inbox"
                              style="
                                font-size: 48px;
                                color: #ccc;
                                margin-bottom: 10px;
                                display: block;
                              "
                            ></i>
                            No equipment registered yet
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <script>
              let equipmentData = [];
              let editingId = null;

              function loadEquipmentData() {
                const savedData = localStorage.getItem("equipmentData");
                if (savedData) {
                  equipmentData = JSON.parse(savedData);
                  renderEquipmentTable();
                }
              }

              function saveEquipmentData() {
                localStorage.setItem(
                  "equipmentData",
                  JSON.stringify(equipmentData)
                );
              }

              function editEquipment(id) {
                const equipment = equipmentData.find((e) => e.id === id);
                if (!equipment) return;

                editingId = id;

                document.getElementById("brandName").value =
                  equipment.brandName;
                document.getElementById("equipmentName").value =
                  equipment.equipmentName;
                document.getElementById("field").value = equipment.field;
                document.getElementById("condition").value =
                  equipment.condition;
                document.getElementById("action").value = equipment.action;
                document.getElementById("rentDuration").value =
                  equipment.rentDuration || "";
                document.getElementById("rentPrice").value =
                  equipment.rentPrice || "";
                document.getElementById("sellPrice").value =
                  equipment.sellPrice || "";
                document.getElementById("description").value =
                  equipment.description;

                if (equipment.image) {
                  document.getElementById("imagePreview").innerHTML = `
        <img src="../Dental/${equipment.image}" alt="Image preview" style="max-width: 100px;">
      `;
                }

                document.getElementById("submitBtnText").textContent =
                  "Save Changes";
                document.getElementById("cancelEdit").style.display =
                  "inline-block";
                togglePriceFields();
              }

              function cancelEdit() {
                editingId = null;
                document.getElementById("equipmentForm").reset();
                document.getElementById("imagePreview").innerHTML = "";
                document.getElementById("submitBtnText").textContent =
                  "Add Equipment";
                document.getElementById("cancelEdit").style.display = "none";
                togglePriceFields();
              }

              function deleteEquipment(id) {
                if (
                  confirm("Are you sure you want to delete this equipment?")
                ) {
                  equipmentData = equipmentData.filter((e) => e.id !== id);
                  saveEquipmentData();
                  renderEquipmentTable();
                }
              }

              function renderEquipmentTable() {
                const tableBody = document.getElementById("equipmentTableBody");

                if (equipmentData.length === 0) {
                  tableBody.innerHTML = `<tr><td colspan="11" class="no-data">No equipment registered yet</td></tr>`;
                  return;
                }

                tableBody.innerHTML = equipmentData
                  .map(
                    (equipment) => `
        <tr>
          <td><img src="../Dental/${
            equipment.image
          }" class="equipment-image" alt="${equipment.equipmentName}"></td>
          <td>${equipment.brandName}</td>
          <td>${equipment.equipmentName}</td>
          <td>${getFieldBadge(equipment.field)}</td>
          <td>${getConditionBadge(equipment.condition)}</td>
          <td>${getActionBadge(equipment.action)}</td>
          <td>${
            equipment.action === "sell"
              ? "-"
              : formatDuration(equipment.rentDuration)
          }</td>
          <td>${
            equipment.action === "sell" ? "-" : formatPrice(equipment.rentPrice)
          }</td>
          <td>${
            equipment.action === "rent" ? "-" : formatPrice(equipment.sellPrice)
          }</td>
          <td title="${equipment.description}">
            ${equipment.description.slice(0, 50)}${
                      equipment.description.length > 50 ? "..." : ""
                    }
          </td>
          <td>
            <button class="delete-btn" onclick="deleteEquipment(${
              equipment.id
            })"><i class="fas fa-trash"></i> Delete</button>
            <button class="edit-btn" onclick="editEquipment(${
              equipment.id
            })"><i class="fas fa-edit"></i> Edit</button>
          </td>
        </tr>
      `
                  )
                  .join("");
              }

              function togglePriceFields() {
                const action = document.getElementById("action").value;
                document.getElementById("rentDurationGroup").style.display =
                  action === "rent" || action === "both" ? "block" : "none";
                document.getElementById("rentPriceGroup").style.display =
                  action === "rent" || action === "both" ? "block" : "none";
                document.getElementById("sellPriceGroup").style.display =
                  action === "sell" || action === "both" ? "block" : "none";
              }

              function formatPrice(price) {
                return price ? parseFloat(price).toFixed(2) + " EGP" : "-";
              }

              function formatDuration(duration) {
                if (!duration || isNaN(duration)) return "-";
                return duration + " days";
              }

              function getFieldBadge(field) {
                const badges = {
                  dental:
                    '<span class="field-badge field-dental">Dentistry</span>',
                  veterinary:
                    '<span class="field-badge field-veterinary">Veterinary</span>',
                  gynecology:
                    '<span class="field-badge field-gynecology">Gynecology</span>',
                };
                return badges[field] || field;
              }

              function getConditionBadge(condition) {
                const badges = {
                  excellent:
                    '<span class="status-badge status-excellent">Excellent</span>',
                  "very-good":
                    '<span class="status-badge status-very-good">Very Good</span>',
                  good: '<span class="status-badge status-good">Good</span>',
                };
                return badges[condition] || condition;
              }

              function getActionBadge(action) {
                const badges = {
                  rent: '<span class="action-badge action-rent">Rent</span>',
                  sell: '<span class="action-badge action-sell">Sell</span>',
                  both: '<span class="action-badge action-both">Both</span>',
                };
                return badges[action] || action;
              }

              // ✅ عرض الصورة بعد الاختيار فقط (معاينة)
              function previewImage(input) {
                const preview = document.getElementById("imagePreview");
                if (input.files && input.files[0]) {
                  const fileName = input.files[0].name;
                  preview.innerHTML = `<img src="../Dental/${fileName}" alt="Image preview" style="max-width: 100px;">`;
                }
              }

              document.addEventListener("DOMContentLoaded", () => {
                loadEquipmentData();
                togglePriceFields();

                document
                  .getElementById("action")
                  .addEventListener("change", togglePriceFields);

                document
                  .getElementById("equipmentForm")
                  .addEventListener("submit", function (e) {
                    e.preventDefault();
                    const formData = new FormData(this);
                    const imageFile = formData.get("equipmentImage");
                    const imagePath =
                      imageFile && imageFile.name ? imageFile.name : "";

                    const equipment = {
                      id: editingId || Date.now(),
                      brandName: formData.get("brandName"),
                      equipmentName: formData.get("equipmentName"),
                      field: formData.get("field"),
                      condition: formData.get("condition"),
                      action: formData.get("action"),
                      rentDuration: parseInt(formData.get("rentDuration")) || 0,
                      rentPrice: parseFloat(formData.get("rentPrice")) || 0,
                      sellPrice: parseFloat(formData.get("sellPrice")) || 0,
                      description: formData.get("description"),
                      image: imagePath, // ✅ تم حفظ اسم الصورة فقط
                    };

                    if (editingId) {
                      const index = equipmentData.findIndex(
                        (e) => e.id === editingId
                      );
                      if (index !== -1) equipmentData[index] = equipment;
                      saveEquipmentData();
                      alert("Updated successfully");
                      cancelEdit();
                    } else {
                      try {
                        equipmentData.push(equipment);
                        saveEquipmentData();
                        alert("Added successfully");
                      } catch (e) {
                        alert(
                          "Sorry, cannot save more data. Please reduce image sizes or delete some items."
                        );
                        return;
                      }
                    }

                    renderEquipmentTable();
                  });
              });

              function logout() {
                localStorage.removeItem("CurrentUser");
                window.location.href = "signin.html";
              }
            </script>
          </body>
        </html>
      </div>
    </div>
  </body>
</html>
